<html>
<head>
<title>Mathspeed</title>
<!--
  inspired by typespeed http://typespeed.sourceforge.net/
  made mostly in 2010
-->
<style>
body { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background-color: black; }
.item { font-size: 40pt; white-space: nowrap; position: absolute; display: none; color: gray; }
#scoreboard { position: absolute; font-size: xx-large; display: inline; top: 50; right: 50; color: cyan; }
#field { position: absolute; font-size: 40pt; }
</style>
<script type="text/javascript" src="jquery-1.4.4.min.js"></script>
<script type="text/javascript">

score = 0;
failures = 0;
ht = wd = 100;
items = {};
frees = [];
ymax = 100;
ymin = 0;
duration = 5000; // ms

function updateboard() {
  if (failures < 10) {
    s = "Score: " + score + " Missed: " + failures;
    $("#scoreboard").text(s);
  }
  else if (failures == 10) {
    $("#scoreboard").text("GAME OVER - " + score);
  }
}

function failure(answer) {
  if (answer in items) {
    item = items[answer].css({display: "none"});
    delete items[answer];
    frees.push(item);
  
    ++failures;
    if (failures >= 10) {
      for (var answer in items) {
        if (items.hasOwnProperty(answer)) {
          items[answer].stop(true);
        }
      }
      items = [];
      frees = [];
    }
       
    updateboard();
    if (frees.length == 30) {
      generate();
    }
  }
}

function generate() {

  if (frees.length < 1) {
    return;
  }

  var question;
  var answer;
  do {
    var r = Math.random();
    if (r < .4) {
      var a = Math.floor(10+Math.random()*19);
      var b = Math.floor(5+Math.random()*4);
      question = (a*b) + "/" + b;
      answer = String(a);
    } else if (r < .8) {
      var a = Math.floor(10+Math.random()*19);
      var b = Math.floor(5+Math.random()*4);
      question = a + "&times;" + b;
      answer = String(a*b);
    } else {
      var a = Math.floor(10+Math.random()*49);
      var b = Math.floor(10+Math.random()*49);
      if (a < b) {
        a += b;
        b = a - b;
	a -= b;
      }
      question = a + "-" + b;
      answer = String(a-b);
    }

  } while (answer in items);

  var item = frees.pop().html(question).css({display: "inline"});
  var left = Math.floor(Math.random() * (wd-item.width()));
  items[answer] = item;
  item.css({left: left, top: 0});
  item.animate({top: ymax}, duration, "linear", function() { failure(answer); });
}

function handleinput(event) {
  if (event.which == 13 || event.which == 32) {
    answer = $("#field").val();
    if (answer in items) {
      score += answer.length * 5;
      updateboard();
      var item = items[answer];
      delete items[answer];
      item.stop().css({display: "none"});
      frees.push(item);
      duration = Math.ceil(duration*.98);
    }
    generate();

    $("#field").val("");
    event.preventDefault();
  }
}

$(function() {
  ht = $("body").height();
  wd = $("body").width();

  var field = $("#field");
  ymax = ht - field.height();
  field.css({top: ymax, left: 0, width: wd});
  ymin = $("#scoreboard").position().top + $("#scoreboard").height();

  for (var i = 0; i < 30; ++i) {
    frees.push($('<span class="item"></span>').appendTo("body"));
  }

  field.val("").focus().keypress(handleinput);

  generate();
  updateboard();
});



</script> 
</head>
<body>
<input type="text" id="field">
<span id="scoreboard">.</span>
</body>
</html>

